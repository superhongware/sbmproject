angular.module("starter",["ionic","loginmodule","creatshowmodule","productsmodule","settingmodule","showsmodule","starter.controllers","starter.services","starter.directives"]).run(["$ionicPlatform","$rootScope","myCookie",function(e,t,l){return t.viewanimate="gogogo","preview1"!==l.get("preview")?(l.add("preview","preview1",2160),void(location.href=location.origin+"/preview.html")):void e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,l){l.views.maxCache(0),l.views.forwardCache(!1),l.templates.maxPrefetch(0),e.state("login",{url:"/login",templateUrl:"templates/index/login/login.html?v=0.0.1",controller:"LoginCtrl"}).state("sign_up",{url:"/sign_up",templateUrl:"templates/index/login/sign_up.html?v=0.0.1",controller:"sign_upCtrl"}).state("taoxiaopu",{url:"/taoxiaopu",templateUrl:"templates/index/login/taoxiaopu.html",controller:"taoxiaopuCtrl"}).state("home",{url:"/home",templateUrl:"templates/index/home.html",controller:"indexCtrl"}).state("shops",{url:"/shops",templateUrl:"templates/index/shops.html",controller:"shopsCtrl"}).state("viewshop",{url:"/viewshop/:url",templateUrl:"templates/index/creatshows/viewtemplate.html",controller:"viewshopCtrl"}).state("shouquanhelp",{url:"/shouquanhelp",templateUrl:"templates/index/setting/shouquanhelp.html"}).state("products",{url:"/products",templateUrl:"templates/index/products/products.html",controller:"productsCtrl"}).state("productDetail",{url:"/productDetail",templateUrl:"templates/index/products/productDetail.html",controller:"productDetailCtrl"}).state("shows",{url:"/shows",templateUrl:"templates/index/shows/shows.html",controller:"showsCtrl"}).state("liuliang",{url:"/liuliang/:showId",templateUrl:"templates/index/shows/liuliang.html",controller:"liuliangCtrl"}).state("orders",{url:"/orders",templateUrl:"templates/index/orders/orders.html",controller:"ordersCtrl"}).state("orderdetail",{url:"/orderdetail",templateUrl:"templates/index/orders/orderdetail.html",controller:"orderdetailCtrl"}).state("setting",{url:"/setting",templateUrl:"templates/index/setting/setting.html",controller:"settingCtrl"}).state("set-shopmanage",{url:"/set-shopmanage",templateUrl:"templates/index/setting/set-shopmanage.html",controller:"shopManage"}).state("set-remind",{url:"/set-remind",templateUrl:"templates/index/setting/set-remind.html"}).state("set-feedback",{url:"/set-feedback",templateUrl:"templates/index/setting/set-feedback.html",controller:"feedBack"}).state("set-aboutus",{url:"/set-aboutus",templateUrl:"templates/index/setting/set-aboutus.html"}).state("set-password",{url:"/set-password",templateUrl:"templates/index/setting/set-password.html",controller:"setPassword"}).state("set-expired",{url:"/set-expired",templateUrl:"templates/index/setting/set-expired.html",controller:"shopManage"}).state("sqsuccess",{url:"/sqsuccess",templateUrl:"templates/index/setting/sqsuccess.html"}).state("sqerror",{url:"/sqerror",templateUrl:"templates/index/setting/sqerror.html"}).state("set-help",{url:"/set-help",templateUrl:"templates/index/setting/set-help.html"}).state("checkproduct",{url:"/checkproduct",templateUrl:"templates/index/creatshows/checkproduct.html",controller:"productsCtrl"}).state("checktemplate",{url:"/checktemplate/:productId/:productPlat",templateUrl:"templates/index/creatshows/checktemplate.html",controller:"checktemplateCtrl"}).state("viewtemplate",{url:"/viewtemplate/:templateId/:productId/:productPlat",templateUrl:"templates/index/creatshows/viewtemplate.html",controller:"viewtemplateCtrl"}).state("editpages",{url:"/editpages",templateUrl:"templates/index/creatshows/editpages.html",controller:"editpagesCtrl"}).state("editpages.editer",{url:"/editer/:showId/:pageId/:pageTemp",templateUrl:function(e){return"templates/index/creatshows/pages/page"+e.pageTemp+".html"},controller:"editerCtrl"}).state("remoteimg",{url:"/remoteimg",templateUrl:"templates/index/creatshows/remoteimg.html",controller:"remoteimgCtrl"}).state("popoverPic",{url:"/popoverPic",templateUrl:"templates/index/creatshows/popoverPic.html",controller:"remoteimgCtrl"}).state("addpage",{url:"/addpage/:showId/:pageId",templateUrl:"templates/index/creatshows/addpage.html",controller:"addpagesCtrl"}).state("viewshow",{url:"/viewshow/:showId",templateUrl:"templates/index/creatshows/viewtemplate.html",controller:"viewshowCtrl"}).state("share",{url:"/share/:showId",templateUrl:"templates/index/creatshows/share.html",controller:"shareCtrl"}).state("sharehelp",{url:"/sharehelp",templateUrl:"templates/index/creatshows/sharehelp.html",controller:"sharehelpCtrl"}).state("appadone",{url:"/appadone",templateUrl:"templates/index/appad/appadone.html",controller:"appadoneCtrl"}).state("testpage",{url:"/testpage",templateUrl:"templates/index/testpage.html",controller:"maintestCtrl"}),t.otherwise("/home")}]);
var starterctrl=angular.module("starter.controllers",[]);starterctrl.controller("mainviewCtrl",["$scope","$rootScope","$log","$ionicLoading","getRequest","loginCheck","showadcheck",function(e,o,t,i,a,c,r){c(),r(),"undefined"!=typeof Tida&&Tida.ready({interactId:"",module:["device","media","server","social","widget","sensor","share","buy","draw","im"]},function(){})}]).controller("indexCtrl",["$scope","$rootScope","loginCheck","getRequest","$http","base64","TBAPI","SBMJSONP",function(e,o,t,i,a,c,r,n){t(),o.ishow=void 0===o.ishow?!0:o.ishow,o.ishows=void 0===o.ishows?!0:o.ishows,o.iup=void 0===o.iup?!0:o.iup,o.showpic=void 0===o.showpic?!0:o.showpic,setTimeout(function(){o.showpic=!1,o.ishows=!1,o.ishow=!1,o.iup=!1},2e3),e.thereisnoshops=!1;var s={orgName:o.orgName,pageNo:1,pageSize:50};s.method="softbanana.app.shop.search";var h=n("searchShop",s);a.jsonp(h.url).success(function(o){e.thereisnoshops=0==o.shops.length?!0:!1}),r.showTitle()}]).controller("appadoneCtrl",["$scope","$rootScope","myCookie",function(e,o,t){t.add("youhaveredad","yeah!youhaveredad",24),o.isthereshowad=""}]).controller("navbarCtrl",["$scope","$rootScope","$ionicHistory","$location","$cacheFactory","$ionicPopup","$ionicScrollDelegate",function(e,o,t,i,a,c,r){e.myGoBack=function(){if(a.get("cacheback")){e.$broadcast("saveShowImg");var t=a.get("cacheback"),i=t.get("count")+2,c="-"+i;history.go(c),t.removeAll(),t.put("url","1"),t.put("count",0)}else $(".addpage").length>0&&!o.editz?(e.$broadcast("saveShowImg"),history.go("-2")):o.editz?(e.$broadcast("saveShowImg"),history.go("-1")):history.go("-1")}}]).controller("contentCtrl",["$scope","$ionicSideMenuDelegate",function(e,o){e.toggleLeft=function(){o.toggleLeft()},e.toggleLeft()}]).controller("maintestCtrl",["$scope","checklocalimg2",function(e,o){e.checklocalimg=function(){o(function(e){EXIF.getData(e,function(){var o=this.exifdata&&this.exifdata.Orientation||1,t=new FileReader;t.readAsDataURL(e),t.onload=function(e){var i=new Image;i.src=e.target.result;var a=document.querySelector("#canvas2"),c=new MegaPixImage(i);c.render(a,{maxWidth:100,maxHeight:100,orientation:o},function(){var e=document.querySelector("#canvas");e.width=a.width,e.height=a.height;var o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),o.drawImage(a,0,0),t.onload=null})}})})}}]);
angular.module("starter.directives",[]).directive("sbmPage",function(){return{restrict:"E",templateUrl:function(e,t){return"templates/index/pages/page"+t.pagenum+".html"}}});
angular.module("service.encryption",[]).factory("hex_md5",function(){function r(r){return i(t(u(r),r.length*C))}function t(r,t){r[t>>5]|=128<<t%32,r[(t+64>>>9<<4)+14]=t;for(var n=1732584193,h=-271733879,u=-1732584194,i=271733878,d=0;d<r.length;d+=16){var C=n,g=h,A=u,S=i;n=e(n,h,u,i,r[d+0],7,-680876936),i=e(i,n,h,u,r[d+1],12,-389564586),u=e(u,i,n,h,r[d+2],17,606105819),h=e(h,u,i,n,r[d+3],22,-1044525330),n=e(n,h,u,i,r[d+4],7,-176418897),i=e(i,n,h,u,r[d+5],12,1200080426),u=e(u,i,n,h,r[d+6],17,-1473231341),h=e(h,u,i,n,r[d+7],22,-45705983),n=e(n,h,u,i,r[d+8],7,1770035416),i=e(i,n,h,u,r[d+9],12,-1958414417),u=e(u,i,n,h,r[d+10],17,-42063),h=e(h,u,i,n,r[d+11],22,-1990404162),n=e(n,h,u,i,r[d+12],7,1804603682),i=e(i,n,h,u,r[d+13],12,-40341101),u=e(u,i,n,h,r[d+14],17,-1502002290),h=e(h,u,i,n,r[d+15],22,1236535329),n=o(n,h,u,i,r[d+1],5,-165796510),i=o(i,n,h,u,r[d+6],9,-1069501632),u=o(u,i,n,h,r[d+11],14,643717713),h=o(h,u,i,n,r[d+0],20,-373897302),n=o(n,h,u,i,r[d+5],5,-701558691),i=o(i,n,h,u,r[d+10],9,38016083),u=o(u,i,n,h,r[d+15],14,-660478335),h=o(h,u,i,n,r[d+4],20,-405537848),n=o(n,h,u,i,r[d+9],5,568446438),i=o(i,n,h,u,r[d+14],9,-1019803690),u=o(u,i,n,h,r[d+3],14,-187363961),h=o(h,u,i,n,r[d+8],20,1163531501),n=o(n,h,u,i,r[d+13],5,-1444681467),i=o(i,n,h,u,r[d+2],9,-51403784),u=o(u,i,n,h,r[d+7],14,1735328473),h=o(h,u,i,n,r[d+12],20,-1926607734),n=a(n,h,u,i,r[d+5],4,-378558),i=a(i,n,h,u,r[d+8],11,-2022574463),u=a(u,i,n,h,r[d+11],16,1839030562),h=a(h,u,i,n,r[d+14],23,-35309556),n=a(n,h,u,i,r[d+1],4,-1530992060),i=a(i,n,h,u,r[d+4],11,1272893353),u=a(u,i,n,h,r[d+7],16,-155497632),h=a(h,u,i,n,r[d+10],23,-1094730640),n=a(n,h,u,i,r[d+13],4,681279174),i=a(i,n,h,u,r[d+0],11,-358537222),u=a(u,i,n,h,r[d+3],16,-722521979),h=a(h,u,i,n,r[d+6],23,76029189),n=a(n,h,u,i,r[d+9],4,-640364487),i=a(i,n,h,u,r[d+12],11,-421815835),u=a(u,i,n,h,r[d+15],16,530742520),h=a(h,u,i,n,r[d+2],23,-995338651),n=c(n,h,u,i,r[d+0],6,-198630844),i=c(i,n,h,u,r[d+7],10,1126891415),u=c(u,i,n,h,r[d+14],15,-1416354905),h=c(h,u,i,n,r[d+5],21,-57434055),n=c(n,h,u,i,r[d+12],6,1700485571),i=c(i,n,h,u,r[d+3],10,-1894986606),u=c(u,i,n,h,r[d+10],15,-1051523),h=c(h,u,i,n,r[d+1],21,-2054922799),n=c(n,h,u,i,r[d+8],6,1873313359),i=c(i,n,h,u,r[d+15],10,-30611744),u=c(u,i,n,h,r[d+6],15,-1560198380),h=c(h,u,i,n,r[d+13],21,1309151649),n=c(n,h,u,i,r[d+4],6,-145523070),i=c(i,n,h,u,r[d+11],10,-1120210379),u=c(u,i,n,h,r[d+2],15,718787259),h=c(h,u,i,n,r[d+9],21,-343485551),n=f(n,C),h=f(h,g),u=f(u,A),i=f(i,S)}return Array(n,h,u,i)}function n(r,t,n,e,o,a){return f(h(f(f(t,r),f(e,a)),o),n)}function e(r,t,e,o,a,c,f){return n(t&e|~t&o,r,t,a,c,f)}function o(r,t,e,o,a,c,f){return n(t&o|e&~o,r,t,a,c,f)}function a(r,t,e,o,a,c,f){return n(t^e^o,r,t,a,c,f)}function c(r,t,e,o,a,c,f){return n(e^(t|~o),r,t,a,c,f)}function f(r,t){var n=(65535&r)+(65535&t),e=(r>>16)+(t>>16)+(n>>16);return e<<16|65535&n}function h(r,t){return r<<t|r>>>32-t}function u(r){for(var t=Array(),n=(1<<C)-1,e=0;e<r.length*C;e+=C)t[e>>5]|=(r.charCodeAt(e/C)&n)<<e%32;return t}function i(r){for(var t=d?"0123456789ABCDEF":"0123456789abcdef",n="",e=0;e<4*r.length;e++)n+=t.charAt(r[e>>2]>>e%4*8+4&15)+t.charAt(r[e>>2]>>e%4*8&15);return n}var d=0,C=8;return r}).factory("base64",function(){function r(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encode=function(r){var t,n,e,o,a,c,f,h="",u=0;for(r=_utf8_encode(r);u<r.length;)t=r.charCodeAt(u++),n=r.charCodeAt(u++),e=r.charCodeAt(u++),o=t>>2,a=(3&t)<<4|n>>4,c=(15&n)<<2|e>>6,f=63&e,isNaN(n)?c=f=64:isNaN(e)&&(f=64),h=h+_keyStr.charAt(o)+_keyStr.charAt(a)+_keyStr.charAt(c)+_keyStr.charAt(f);return h},this.decode=function(r){var t,n,e,o,a,c,f,h="",u=0;for(r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<r.length;)o=_keyStr.indexOf(r.charAt(u++)),a=_keyStr.indexOf(r.charAt(u++)),c=_keyStr.indexOf(r.charAt(u++)),f=_keyStr.indexOf(r.charAt(u++)),t=o<<2|a>>4,n=(15&a)<<4|c>>2,e=(3&c)<<6|f,h+=String.fromCharCode(t),64!=c&&(h+=String.fromCharCode(n)),64!=f&&(h+=String.fromCharCode(e));return h=_utf8_decode(h)},_utf8_encode=function(r){r=r.replace(/\r\n/g,"\n");for(var t="",n=0;n<r.length;n++){var e=r.charCodeAt(n);128>e?t+=String.fromCharCode(e):e>127&&2048>e?(t+=String.fromCharCode(e>>6|192),t+=String.fromCharCode(63&e|128)):(t+=String.fromCharCode(e>>12|224),t+=String.fromCharCode(e>>6&63|128),t+=String.fromCharCode(63&e|128))}return t},_utf8_decode=function(r){for(var t="",n=0,e=0,o=0;n<r.length;)e=r.charCodeAt(n),128>e?(t+=String.fromCharCode(e),n++):e>191&&224>e?(o=r.charCodeAt(n+1),t+=String.fromCharCode((31&e)<<6|63&o),n+=2):(o=r.charCodeAt(n+1),c3=r.charCodeAt(n+2),t+=String.fromCharCode((15&e)<<12|(63&o)<<6|63&c3),n+=3);return t}}return new r});
angular.module("starter.services",["service.encryption"]).factory("myCookie",function(){return{add:function(t,e,a){var n=t+"="+escape(e);if(a>0){var o=new Date;o.setTime(o.getTime()+3600*a*1e3),n=n+"; expires="+o.toGMTString()}document.cookie=n},get:function(t){for(var e=document.cookie,a=e.split("; "),n=0;n<a.length;n++){var o=a[n].split("=");if(o[0]==t)return unescape(o[1])}return""},"delete":function(t){var e=new Date;e.setTime(e.getTime()-1e4),document.cookie=t+"=v; expires="+e.toGMTString()}}}).factory("creatpsurl",["base64url",function(t){return function(e,a,n,o){var r="orgname="+e;return r+="&detailid="+a,r+="&productid="+n,r+="&plat="+o,r="http://baobeixiu.softbanana.com/ps.html?"+t(r)}}]).factory("creatpsurl2",["base64url",function(t){return function(e,a,n,o){var r="orgname="+e;return r+="&detailid="+a,r+="&productid="+n,r+="&plat="+o,r=location.origin+"/ps.html?"+t(r)}}]).factory("base64url",["base64",function(t){return function(e){return encodeURIComponent(t.encode(e))}}]).factory("debase64url",["base64",function(t){return function(e){return t.decode(decodeURIComponent(e))}}]).factory("dateFormat",function(){return function(t,e){var a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in a)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[n]:("00"+a[n]).substr((""+a[n]).length)));return e}}).factory("loginCheck",["$state","myCookie","base64","base64url","getRequest2","$rootScope","debase64url",function(t,e,a,n,o,r,i){return function(){var n=o("orgName"),i=o("shopName");r.istaobao===!0||r.orgName||(n&&i?(r.istaobao=!0,r.orgName=n,r.plat="TAOBAO",r.shopName=i):e.get("orgName")?(r.orgName=a.decode(e.get("orgName")),r.userName=a.decode(e.get("userName")),r.istaobao=!1):(r.istaobao=!1,t.go("login")))}}]).factory("hrefGo",function(){return function(t){location.href=t}}).factory("SBMJSONP",["jsonpURL","systemdata",function(t,e){return function(a,n){var o=e(n),r="http://swapi.hongware.com/openApi/dyncSoftBanana/app/"+a;return{url:t(r,o)}}}]).factory("SBMPOST",["postURL","systemdata",function(t,e){return function(a,n){var o=e(n);o=t(o);var r="http://swapi.hongware.com/openApi/dyncSoftBanana/app/"+a;return{url:r,data:o}}}]).factory("jsonpURL",function(){return function(t,e){t+="?";for(var a in e)t+=a+"="+encodeURIComponent(e[a])+"&";return t+"callBack=JSON_CALLBACK"}}).factory("postURL",function(){return function(t){var e="";for(var a in t)e+=a+"="+t[a]+"&";return e.substr(0,e.length-1)}}).factory("systemdata",["hex_md5","base64",function(t,e){return function(a){if("undefined"==typeof a.method)throw"SBMJSONP或SBMPOST的data参数里没有method,赶紧查下接口文档";a="object"==typeof a?a:{};var n=new Date,o={nick:"softbanana",name:"softbanana",timestamp:parseInt(n.getTime()/1e3).toString(),format:"json"},r=e.encode(o.nick)+e.encode(a.method)+e.encode(o.timestamp)+e.encode(o.name)+e.encode(o.format);return o.sign=t(r),$.extend(o,a)}}]).factory("getDataComm",["$http","SBMJSONP","$rootScope",function(t,e,a){var n={};return n.platObj={YHD:{imgSrc:"img/plat/yhd.png",name:"一号店"},DANGDANG:{imgSrc:"img/plat/dd.png",name:"当当"},JINGD:{imgSrc:"img/plat/jd.png",name:"京东"},PAIPAI:{imgSrc:"img/plat/pp.png",name:"拍拍"},TAOBAO:{imgSrc:"img/plat/tb.png",name:"淘宝"},TMALL:{imgSrc:"img/plat/tmall.png",name:"天猫"},WD:{imgSrc:"img/plat/wd.png",name:"微店"},AMAZON:{imgSrc:"img/plat/amz.png",name:"亚马逊"},KDT:{imgSrc:"img/plat/youzan.png",name:"有赞"}},n.loadShopList=function(n,o){var r=e("searchShop",{method:"softbanana.app.shop.search",orgName:a.orgName,pageNo:1,pageSize:50,action:""});t.jsonp(r.url).success(function(t){if(t.isSuccess&&t.shops&&t.shops.length>0){for(var e=[],a=0;a<t.shops.length;a++)t.shops[a].isInvalid&&e.push(t.shops[a]);e[0].checked=!0,n(e)}}).error(function(t,e){o(t,e,"数据查询失败")})},n}]).factory("orderComm",["$http","SBMJSONP","$rootScope",function(t,e,a){var n={};return n.orderStatusList=[{name:"已付款",status:"PAID"},{name:"未付款",status:"NON_PAYMENT"},{name:"已打印",status:"PRINTED"},{name:"已发货",status:"DELIVERED"},{name:"已取消",status:"CANCELED"},{name:"已完成",status:"COMPLETED"},{name:"全部",status:""}],n.getStatusName=function(t){for(var e="",a=0;a<n.orderStatusList.length;a++)if(t==n.orderStatusList[a].status){e=n.orderStatusList[a].name;break}return e},n}]).factory("productComm",["$http","SBMJSONP","$rootScope","getDataComm","dateFormat",function(t,e,a,n,o){var r={};return r.statusList=[{name:"上架中",status:"onsale"},{name:"已下架",status:"instock"}],r.getStatusName=function(t){for(var e="",a=0;a<statusList.length;a++)if(t==statusList[a].status){e=statusList[a].name;break}return e},r.loadProductData=function(o,r,i){var s={method:"softbanana.app.item.search",orgName:a.orgName,shopName:o.shopName,status:o.status,action:o.action,pageNo:o.pageNo,pageSize:o.pageSize,plat:o.plat},c=e("searchItem",s);t.jsonp(c.url).success(function(t){var e=[],a=0;if(t.isSuccess&&parseInt(t.totalCount)>0&&t.items&&t.items.length>0)if(t.items.sort(function(t,e){return parseInt(t.id)>parseInt(e.id)?-1:1}),"up"===o.action)for(a=0;a<t.items.length;a++)e.push(t.items[a]);else for(a=t.items.length-1;a>=0;a--)e.unshift(t.items[a]);for(a=0;a<e.length;a++)e[a].picPlatUrl=n.platObj[e[a].plat].imgSrc;r(e)}).error(function(t,e){i(t,e,"数据查询失败")})},r.loadProductDetail=function(a,n,o){var r={method:"softbanana.app.item.detail.search",orgName:a.orgName,numIid:a.numIid,plat:a.plat},i=e("searchItemDetail",r);t.jsonp(i.url).success(function(t){t.isSuccess?n(t.item):o("数据查询失败")}).error(function(t,e){o("数据查询失败",t,e)})},r.refreshServer=function(n,r,i){var s=new Date,c={method:"softbanana.app.item.list",orgName:a.orgName,shopName:n.shopName,plat:n.plat,endDate:o(s,"yyyy-MM-dd hh:mm:ss")};s.setMonth(s.getMonth()-1),c.startDate=o(s,"yyyy-MM-dd hh:mm:ss");var u=e("listItem",c);t.jsonp(u.url).success(function(t){r(t)}).error(function(t,e){i(t,e,"数据查询连接失败")})},r}]).factory("getRequest",function(){return function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(e);return null!==a?unescape(a[2]):null}}).factory("getRequest2",["debase64url",function(t){return function(e){var a=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1),o=n.indexOf("&");-1!==o&&(n=n.substring(0,o));var r=t(n).match(a);return null!==r?unescape(r[2]):null}}]).factory("showadcheck",["$rootScope","myCookie",function(t,e){return function(){t.istaobao||e.get("youhaveredad")||(t.isthereshowad="showad")}}]).factory("TBAPI",function(){function t(){this.hideTitle=function(){"undefined"!=typeof Tida&&"undefined"!=typeof Tida.hideTitle&&Tida.hideTitle()},this.showTitle=function(){"undefined"!=typeof Tida&&"undefined"!=typeof Tida.showTitle&&Tida.showTitle()}}return new t}).factory("showedition",function(){return function(t){var e=$(".showlistitem").eq(t),a=e.find(".item-options");a.hasClass("invisible")?(a.removeClass("invisible"),e.find(".item-content").css({"-webkit-transform":" translate3d(-"+a.width()+"px, 0px, 0px)"})):(e.find(".item-content").css({"-webkit-transform":" translate3d(-0px, 0px, 0px)"}),a.addClass("invisible"))}}).factory("shouquan",["$rootScope",function(t){var e={TMALL:"http://fuwu.taobao.com/ser/detail.html?spm=a1z13.1113643.0.0.Wp7gXJ&service_code=FW_GOODS-1000049183&tracelog=search",TAOBAO:"http://fuwu.taobao.com/ser/detail.html?spm=a1z13.1113643.0.0.Wp7gXJ&service_code=FW_GOODS-1000049183&tracelog=search",KDT:"https://open.koudaitong.com/oauth/authorize?client_id=2c436c071a453a55&response_type=code&state=softbanana&redirect_uri=http://api.softbanana.com/openApi/kdtback/"+t.orgCode+"/kdt",JINGD:"http://fw.jd.com/94404.html",PAIPAI:"http://fw.paipai.com/193744.html",WD:"https://api.vdian.com/oauth2/authorize?appkey=617938&redirect_uri="+encodeURI("http://api.softbanana.com/openApi/wdback/"+t.orgCode+"/kdgw")+"&response_type=code&state=STATE",DANGDANG:"http://fuwu.dangdang.com/appdetail?app_id=2100003535",YHD:"http://fuwu.yhd.com/application/gotoAppDetail.do?appId=3753"};return e}]);
var creatshowmodule=angular.module("creatshowmodule",["ionic","starter.services","starter.directives"]);creatshowmodule.controller("checktemplateCtrl",["$rootScope","$scope","$http","$stateParams","$ionicLoading","$state","getTemplate","creatShow","myloadover","SBMJSONP",function(e,t,a,o,r,i,n,s,c,d){e.SaveChange=void 0,t.productId=o.productId,t.productPlat=o.productPlat;var p={orgName:e.orgName,pageSize:"50",method:"softbanana.app.template.list"},l=d("listTemplate",p);a.jsonp(l.url).success(function(e){c(e.templates),t.viewsarr=e.templates})}]).controller("viewtemplateCtrl",["$scope","$rootScope","$stateParams","$ionicLoading","$state","creatShow",function(e,t,a,o,r,i){$(".viewtemplate").append('<iframe class="viewbox" height='+($(window).height()-44)+" src="+location.origin+"/ps.html?templateview="+a.templateId+"&orgname="+t.orgName+' frameborder="0"></iframe>'),e.viewbtnneam="应用",e.viewneam="模板预览",e.viewbtn=function(){o.show({template:"正在提取宝贝数据到模板,请稍等..."});var e={templateId:a.templateId,productId:a.productId,productPlat:a.productPlat};i(e,function(e){o.hide(),r.go("editpages.editer",{showId:e.detailId,pageId:0,pageTemp:e.firstPageTemp})},function(e){alert(e)})}}]).controller("viewshowCtrl",["$scope","$rootScope","$stateParams","$state","$ionicLoading","creatShow","creatpsurl2",function(e,t,a,o,r,i,n){t.editShowData&&t.editShowData.mainData&&(t.editShowData.mainData=void 0);var s=n(t.orgName,a.showId,"0","0");s+="&showview=true",$(".viewtemplate").append('<iframe class="viewbox" height='+($(window).height()-44)+" src="+s+' frameborder="0"></iframe>'),e.viewbtnneam="分享",e.viewneam="宝贝秀预览",e.viewbtn=function(){o.go("share",{showId:a.showId})}}]);
creatshowmodule.controller("addpagesCtrl",["$scope","$rootScope","$http","$stateParams","$state","$ionicLoading","saveShow",function(a,t,e,o,d,p,i){e.get("testdata/pagetemplate.json").success(function(t){a.tempdata=t}).error(function(){alert("网络有问题,没有获取模板数据")}),a.addpage=function(e){p.show({template:"正在保存,请稍等..."});var s=t.editShowData.mainData.pages,n=a.tempdata.pages[e].pagedata,g=parseInt(o.pageId)+1;s.splice(g,0,n),i(t.editShowData.mainData,function(o){t.editShowData.mainData=void 0,p.hide(),d.go("editpages.editer",{showId:t.editShowData.showId,pageId:g,pageTemp:a.tempdata.pages[e].pagedata.templatePageId})},function(){})}}]);
creatshowmodule.controller("pagetempht1Ctrl",["$scope","$rootScope","$state","$stateParams","$ionicLoading","$location","$ionicActionSheet","setShowImg","drawShowImg","compressShowImg","sendShowImg","saveShow","checklocalimg",function(i,t,e,n,o,a,s,g,r,c,d,p,m){i.imgviewinfo=[],i.showdata=t.editShowData,i.$on("$destroy",function(){f(),h()});var f=i.$on("tempImgngRepeatFinished",function(){if(t.REMOTEIMGINFO={shopName:t.editShowData.mainData.shopName,plat:t.editShowData.mainData.plat},void 0!==t.picurl){var e=parseInt(t.Index)+1,n=$(".ps_img"+e);n.find(".innerimg").attr("src",t.picurl).show(),t.editShowData.mainData.pages[t.pic_pageId].detailPageImage[t.Index].img=t.picurl,t.picurl=void 0}$(".editplace").find(".ps_img").each(function(e){function n(i){c.holdpoint=[i.gesture.center.pageX-$(".editplace")[0].offsetLeft,i.gesture.center.pageY-$(".editplace")[0].offsetTop],d=1,$(this).css({border:"2px solid #fe9900"})}function o(i){"dragstart"===i.type?(c.startpoint[0]=c.point[0],c.startpoint[1]=c.point[1],t.xychange=!0):c.scale[1]=c.scale[0]}function a(i){d||("drag"===i.type?(c.point[0]=parseInt(i.gesture.deltaX)+c.startpoint[0],c.point[1]=parseInt(i.gesture.deltaY)+c.startpoint[1]):d||(c.scale[0]=i.gesture.scale*c.scale[1]),$(this).find(".innerimg").css({"-webkit-transform":"translate3d("+c.point[0]+"px,"+c.point[1]+"px,0px) scale("+c.scale[0]+")"}))}function s(t){if(d){var e=c.holdpoint[0]+t.gesture.deltaX,n=c.holdpoint[1]+t.gesture.deltaY;d=0;var o="";r.css({border:"none"});for(var a=0;a<i.imgviewinfo.length;a++)g(e,n,i.imgviewinfo[a].imgboxposition)&&(o=a);if(r.index()!==o){var s=r.find("img"),p=$(".editplace").find(".ps_img").eq(o).find("img"),m=s.attr("src");s.attr("src",p.attr("src")),p.attr("src",m),i.imgviewinfo[r.index()].changed=1,i.imgviewinfo[r.index()].img=s[0],i.imgviewinfo[o].changed=1,i.imgviewinfo[o].img=p[0]}}}function g(i,t,e){return i>e[0]&&i<e[2]&&t>e[1]&&t<e[3]?!0:!1}var r=$(this),c=i.imgviewinfo[e];c.startpoint=[0,0],c.point=[0,0],c.scale=[1,1],c.imgboxposition=[this.offsetLeft,this.offsetTop,this.offsetLeft+this.offsetWidth,this.offsetTop+this.offsetHeight],ionic.onGesture("dragstart",o,this),ionic.onGesture("drag",a,this),ionic.onGesture("release",s,this),ionic.onGesture("transformstart",o,this),ionic.onGesture("transform",a,this);var d=0,p=$(".editplace").find(".ps_img").length;p>1&&ionic.onGesture("hold",n,this),c.img=$(this).find("img").show()[0],c.imgbox=$(this)})}),h=i.$on("saveShowImg",function(){function e(){var o=r(i.imgviewinfo[s[a]]),g=c(o,80);d(g,function(o){t.editShowData.mainData.pages[i.showdata.currentpage].detailPageImage[s[a]].img=o,a++,s.length>a?e():n()})}function n(){p(t.editShowData.mainData,function(t){o.hide(),i.$emit("saveShowImgOver")},function(i){})}o.show({template:"正在保存,请稍等..."});var a=0,s=[];void 0!==t.Index&&(i.imgviewinfo[t.Index].changed=1,t.Index=void 0);for(var g=i.imgviewinfo.length-1;g>=0;g--)(i.imgviewinfo[g].changed||0!==i.imgviewinfo[g].point[0]||0!==i.imgviewinfo[g].point[1]||void 0!==t.picurl)&&s.push(g);s.length>0?e():n()});i.setimg=function(o){t.Index=o,t.pic_showId=n.showId,t.pic_pageId=n.pageId,t.pic_pageTemp=n.pageTemp,s.show({buttons:[{text:"本机图片"},{text:"店铺图片空间"}],titleText:"选择图片源",cancelText:"取消",cancel:function(){},buttonClicked:function(n){return 0===n?m(function(e){i.imgviewinfo[o].changed=1;var n=i.imgviewinfo[o],a=$(".ps_img"+(o+1));n.img=e,a.find(".innerimg").attr("src",i.imgviewinfo[o].img.src).show(),t.editShowData.mainData.pages[t.pic_pageId].detailPageImage[t.Index].img=i.imgviewinfo[o].img.src,i.$broadcast("saveShowImg")}):e.go("remoteimg"),!0}})}}]);
creatshowmodule.directive("onFinishRenderFilters",["$timeout",function(e){return{restrict:"A",link:function(t,i,a){t.$last===!0&&e(function(){t.$emit("ngRepeatFinished")})}}}]).directive("onFinishTempImg",["$timeout",function(e){return{restrict:"A",link:function(t,i,a){t.$last===!0&&e(function(){t.$emit("tempImgngRepeatFinished")})}}}]).directive("pageEditor",["$rootScope","$state","$animate","$timeout","$ionicLoading","$ionicScrollDelegate","$location","$cacheFactory",function(e,t,i,a,n,o,r,d){return{templateUrl:"templates/index/creatshows/pageeditor.html",link:function(i,a,n,s){var c=o.$getByHandle("smallpages");i.editpages=0;var p=(ionic.onGesture("hold",function(){i.editpages=1,i.$apply()},$(".pagelistbox")[0]),$(window).width()),g=[],l=[];i.$on("ngRepeatFinished",function(){e.editShowData.mainData.pages;$(".pageitem").each(function(a){var n=$(this),o=71;ionic.onGesture("dragstart",function(e){var t=c.getScrollPosition();l[a]={},l[a].boxleftstart=t.left,l[a].boxleftmove=0,l[a].moveindex=""},this),ionic.onGesture("drag",function(e){if(i.editpages)if(n.hasClass("dragpages")){c.freezeScroll(!0);var t=c.getScrollPosition(),r=t.left,d=20,s=-n.index()*o-4,m=e.gesture.deltaX,u=s-m+l[a].boxleftmove+l[a].boxleftstart-r,x=Math.round(-u/o);l[a].moveindex=x,d>-r-u&&r>=0?c.scrollTo(r-1,t.top):-r-u>p-o-d&&r<=$(".pageitem").length*o-p&&c.scrollTo(r+1,t.top),n.css({"z-index":"99","-webkit-transform":"translate3d("+-u+"px,"+e.gesture.deltaY+"px,0px)"})}else"undefined"!=typeof g[a]&&g[a][0]||(g[a]=[],g[a][0]=!0,g[a][1]=setTimeout(function(){n.addClass("dragpages")},500))},this),ionic.onGesture("dragend",function(i){if(g[a]&&g[a][0]&&(g[a][0]=!1,clearTimeout(g[a][1]),n.hasClass("dragpages"))){var r=e.editShowData.mainData.pages;if("undefined"!=typeof l[a].moveindex&&l[a].moveindex!==n.index()){l[a].moveindex=l[a].moveindex<=0?0:l[a].moveindex,l[a].moveindex=l[a].moveindex>=$(".pageitem").length?$(".pageitem").length-1:l[a].moveindex,dragpage=r[n.index()],r.splice(n.index(),1);{n.index()>l[a].moveindex?l[a].moveindex:l[a].moveindex-1}r.splice(l[a].moveindex,0,dragpage);var d=e.editShowData,s="";if(n.index()===d.currentpage&&l[a].moveindex!==d.currentpage?s=l[a].moveindex:n.index()<d.currentpage&&l[a].moveindex>=d.currentpage?s=d.currentpage-1:n.index()>d.currentpage&&l[a].moveindex<=d.currentpage&&(s=d.currentpage+1),s){var p={showId:d.showId,pageId:s,pageTemp:d.mainData.pages[s].templatePageId};t.go("editpages.editer",p)}}else l[a].moveindex===n.index()&&n.css({"z-index":"initial","-webkit-transform":"translate3d("+(n.index()*o+4)+"px,0px,0px)"});e.$apply(),c.freezeScroll(!1),n.removeClass("dragpages")}},this)})});var m=e.editShowData.currentpage;e.itemclickcount=0,i.pageitemclick=function(t){var a=r.absUrl();if(d.get("cacheback")){o=d.get("cacheback");var n=o.get("count");o.put("url",a),o.put("count",n)}else{var o=d("cacheback");o.put("url",a),o.put("count",0)}return i.editpages?void(i.editpages=0):(m=t,i.$broadcast("saveShowImg"),void(e.SaveChange=!0))},i.$on("$destroy",function(){u()});var u=i.$on("saveShowImgOver",function(){m!==e.editShowData.currentpage&&t.go("editpages.editer",{showId:e.editShowData.showId,pageId:m,pageTemp:e.editShowData.mainData.pages[m].templatePageId})});i.deletethispage=function(t){var i=e.editShowData.mainData.pages;$(".pageitem").eq(t).on("webkitTransitionEnd",function(){$(".pageitem").eq(t).off("webkitTransitionEnd"),e.$emit("showdatachanged")}),i.splice(t,1)},i.pageitemposition=function(e){return{"-webkit-transform":"translate3d("+71*e+"px,0px,0px)"}}}}}]).directive("normalEditContent",function(){return{templateUrl:"templates/index/creatshows/pages/normaleditcontent.html",link:function(e,t,i,a){}}}).directive("dragimg",function(){return{templateUrl:"templates/index/creatshows/pages/dragimgbox.html",link:function(e,t,i,a){}}});
creatshowmodule.controller("remoteimgCtrl",["$rootScope","$scope","$state","$ionicHistory","getremoteimgcat","$ionicPopover","SBMJSONP","$http","saveShow","SBMPOST",function(o,t,e,i,a,r,n,c,s,p){function m(){var e={orgName:o.orgName,wayId:o.editShowData.mainData.plat,numIid:o.editShowData.mainData.numIid,method:"softbanana.app.picture.category.search"},i=n("searchPictureCategory",e);c.jsonp(i.url).success(function(o){var i=o.images.pictureUrl.split(","),a=[];for(var r in i)""!==i[r]&&a.push({URL:i[r]});if(o.isSuccess)for(var n=0;n<a.length;n++)if("TAOBAO"===e.wayId)a[n].URL2=a[n].URL+"_100x100.jpg";else if("TMALL"===e.wayId)a[n].URL2=a[n].URL+"_100x100.jpg";else if("JINGD"===e.wayId){var c=[];c=a[n].URL.split("/"),c[3]="n4",c=c.join("/"),a[n].URL2=c}else a[n].URL2=a[n].URL;t.pics=a}).error(function(o){})}t.remoteimgcat=[],t.remoteimg={},t.goback=function(){$ionicHistorsy.goBack()},t.refreshimg=function(){},m(),t.uppic=function(t){o.picurl=t,s(o.editShowData.mainData,function(t){o.editShowData.mainData=void 0,history.go(-1)},function(){})},r.fromTemplateUrl("templates/index/creatshows/popoverPic.html",{scope:t}).then(function(o){t.popover=o}),t.openPopover=function(o){t.popover.show(o)}}]);
creatshowmodule.factory("changepagesize",function(){return function(){var t=parseInt($(window).height()-110-44),e=parseInt(.9*t),a=parseInt(.635*e),n=44+parseInt((t-e)/2);$(".editplace").css({height:e,width:a,top:n}),$(".pagelistbox").css({top:n+e+23})}}).factory("setShowImg",["$rootScope","$http","SBMJSONP","SBMPOST",function(t,e,a,n){return function(a,o){function i(t){u.point[0]=t.gesture.deltaX+u.startpoint[0],u.point[1]=t.gesture.deltaY+u.startpoint[1],u.scale[0]=t.gesture.scale*u.scale[1],u.rotation[0]=u.rotation[1]+Math.PI/360*t.gesture.rotation,c(u.img)}function r(t){u.point[0]=t.gesture.deltaX+u.startpoint[0],u.point[1]=t.gesture.deltaY+u.startpoint[1],u.scale[0]=t.gesture.scale*u.scale[1],u.rotation[0]=u.rotation[1]+Math.PI/360*t.gesture.rotation,c(u.img)}function c(t){m.clearRect(0,0,s.width,s.height),m.save(),m.translate(u.point[0],u.point[1]),m.rotate(u.rotation[0]),m.scale(u.scale[0],u.scale[0]),m.drawImage(t,u.point[0],u.point[1]),m.restore()}function l(t){var e=t.target.files[0];if(e.type.match("image.*")){var a=new FileReader;a.readAsDataURL(e),a.onload=function(t){var e=new Image;e.src=t.target.result,u.img=e,c(u.img)}}}function g(t,e,a){var n="image/jpeg";void 0!==a&&"png"==a&&(n="image/png");var o=document.createElement("canvas");o.width=t.naturalWidth,o.height=t.naturalHeight;var i=(o.getContext("2d").drawImage(t,0,0),o.toDataURL(n,e/100));return i}document.getElementById("fileImg").click();var s=document.getElementById("maincanvas"),m=s.getContext("2d"),u={startpoint:[0,0],point:[0,0],scale:[1,1],rotation:[0,0],img:""};s.width=a[0],s.height=a[1],$(".checkimgbox").show(),$(".leftbtn").click(function(){$(".checkimgbox").hide()}),$(".rightbtn").click(function(){var a={orgName:t.orgName,method:"softbanana.app.image.upload",imageData:encodeURIComponent(g(u.img,50))},i=n("uploadImage/uploadFile",a);e.post(i.url,i.data).success(function(t){$(".checkimgbox").hide(),o(t.image.imageUrl)}).error(function(t){})}),$(s).on("touchstart",function(t){u.startpoint[0]=u.point[0],u.startpoint[1]=u.point[1],u.startpoint[1]=u.point[1],u.startpoint[1]=u.point[1],u.scale[1]=u.scale[0],u.rotation[1]=u.rotation[0]}),ionic.onGesture("transform",i,s),ionic.onGesture("drag",r,s),document.getElementById("fileImg").addEventListener("change",l,!1)}}]).factory("drawShowImg",function(){return function(t,e){var a=document.createElement("canvas");e&&(a=e);var n=a.getContext("2d"),o=640/t.imgbox.parents(".ps_page")[0].clientWidth,i=t.img.naturalWidth,r=t.img.naturalHeight;a.width=t.imgbox[0].clientWidth*o,a.height=t.imgbox[0].clientHeight*o,n.clearRect(0,0,a.width,a.height),n.save();var c=a.width/i;n.scale(c,c);var l=t.point[0]*o/c+i/2,g=t.point[1]*o/c+r/2;return n.translate(l,g),n.scale(t.scale[0],t.scale[0]),n.translate(-i/2,-r/2),n.drawImage(t.img,0,0),n.restore(),a}}).factory("drawShowImg2",["compressShowImg",function(t){return function(t,e){var a=document.createElement("canvas");e&&(a=e);var n=a.getContext("2d");return n.drawImage(t.img,0,0),a}}]).factory("compressShowImg",function(){return function(t,e,a){var n="image/jpeg";void 0!==a&&"png"==a&&(n="image/png");var o=t.toDataURL(n,e/100);return o}}).factory("creatShow",["$rootScope","$http","SBMJSONP","productComm","saveShow","setProductImg",function(t,e,a,n,o,i){return function(r,c,l){n.loadProductDetail({orgName:t.orgName,numIid:r.productId,plat:r.productPlat},function(n){var g={orgName:t.orgName,method:"softbanana.app.template.detail",templateId:parseInt(r.templateId)},s=a("detailTemplate",g);e.jsonp(s.url).success(function(t){t=t.template;for(var e=0;e<t.pages.length;e++){var a=t.pages[e].detailPageImage.split(","),g=[];for(var s in a)g.push({img:a[e]});var m=t.pages[e].detailPageText.split(">>"),u=[];for(var d in m)u.push({txt:m[d]});t.pages[e].detailPageImage=g,t.pages[e].detailPageText=u}var p=n.picUrl.split(",");t.detailTitle=n.title,t.detailDesc="超好超好，超赞超赞，就要他啦，oh！我的宝贝！",t.detailImage=p[0],t.shopName=n.shopName,t.numIid=n.numIid,t.detailUrl=n.detailUrl,t.plat=r.productPlat,t.detailId="",t=i(p,t),o(t,function(e){e.firstPageTemp=t.pages[0].templatePageId,c(e)},function(t){l(t)})}).error(function(t,e,a){l(t,e,a)})},function(t,e,a){l(t,e,a)})}}]).factory("setProductImg",function(){return function(t,e){for(var a=e.pages,n=t.length,o=0,i=0;i<a.length;i++)for(var r=a[i].detailPageImage.length,c=0;r>c;c++)a[i].detailPageImage[c].img=t[o],o++,o==n&&(o=0);return e}}).factory("saveShow",["$rootScope","$http","$location","SBMJSONP","SBMPOST","productComm",function(t,e,a,n,o,i){return function(a,n,i){var r={orgName:t.orgName,detailId:a.detailId,method:"softbanana.app.detail.saveOrUpdate"},c=o("saveOrUpdateDetail",r);c.data+="&detailData="+encodeURIComponent(JSON.stringify(a)),e.post(c.url,c.data).success(function(t){t.isSuccess?n(t):i(t.map.errorMsg)}).error(function(t,e){alert("保存宝贝秀失败-网络链接有问题~")})}}]).factory("getTemplate",["$rootScope","$http","SBMJSONP",function(t,e,a){return function(n,o){var i={orgName:t.orgName,action:"",pageNo:"",pageSize:10,method:"softbanana.app.template.list"},r=a("listTemplate",i);e.jsonp(r.url).success(function(t){n(t)}).error(function(t,e){o(t,e)})}}]).factory("getremoteimgcat",["$http","$rootScope","SBMJSONP",function(t,e,a){return function(n){var o={orgName:e.orgName,shopName:e.editShowData.mainData.shopName,plat:e.editShowData.mainData.plat,method:"softbanana.app.picture.category.search"},i=a("searchPictureCategory",o);t.jsonp(i.url).success(function(t){n(t)}).error(function(t){})}}]).factory("sendShowImg",["$rootScope","$http","SBMJSONP","SBMPOST",function(t,e,a,n){return function(a,o){var i={orgName:t.orgName,method:"softbanana.app.image.upload",imageData:encodeURIComponent(a)},r=n("uploadImage/uploadFile",i);e.post(r.url,r.data).success(function(t){o(t.image.imageUrl)}).error(function(t){})}}]).factory("checklocalimg",["$ionicLoading",function(t){return function(e){function a(o){t.show({template:"请稍等..."}),n.removeEventListener("change",a,!1);var i=o.target.files[0];i.type.match("image.*")&&EXIF.getData(i,function(){var a=this.exifdata&&this.exifdata.Orientation||1,n=new FileReader;n.readAsDataURL(i),n.onload=function(o){var i=new Image;i.src=o.target.result;var r=new MegaPixImage(i);r.render(i,{maxWidth:640,maxHeight:1008,quality:1,orientation:a},function(){n.onload=null,e(i),t.hide()})}})}var n;document.getElementById("fileImg")?n=document.getElementById("fileImg"):(n=document.createElement("input"),n.id="fileImg",n.type="file",n.accept="image/*",document.body.appendChild(n)),n.addEventListener("change",a,!1),n.click()}}]).factory("checklocalimg3",function(){return function(t){function e(n){a.removeEventListener("change",e,!1);var o=n.target.files[0];if(o.type.match("image.*")){var i=new FileReader;i.readAsDataURL(o),i.onload=function(e){var a=new Image;a.src=e.target.result,t(a)}}}var a;document.getElementById("fileImg")?a=document.getElementById("fileImg"):(a=document.createElement("input"),a.id="fileImg",a.type="file",a.accept="image/*",document.body.appendChild(a)),a.addEventListener("change",e,!1),a.click()}}).factory("checklocalimg2",function(){return function(t){function e(n){a.removeEventListener("change",e,!1),t(n.target.files[0])}var a;document.getElementById("fileImg")?a=document.getElementById("fileImg"):(a=document.createElement("input"),a.id="fileImg",a.type="file",a.accept="image/*",document.body.appendChild(a)),a.addEventListener("change",e,!1),a.click()}}).factory("checkoutbaobei",["$rootScope","$ionicPopup","productComm",function(t,e,a){return function(n,o){a.loadProductDetail({orgName:t.orgName,numIid:n,plat:o},function(a){"onsale"!==a.status?(t.zmyOnsale=!1,e.show({title:"分享提示",template:"该宝贝已下架,上架宝贝后分享才有效果哦！",buttons:[{text:"我知道了",type:"button-energized"}]})):t.zmyOnsale=!0},function(t){})}}]).factory("myloadover",["$rootScope",function(t){return function(t){function e(){o/n.length==1&&($(".loadingbox").css({opacity:"0","-webkit-transition":"0.5s ease-in"}),setTimeout(a,100))}function a(){function t(){$(".loadingbox").hide()}$(".loadingbox")[0].addEventListener("webkitTransitionEnd",t)}for(var n=[],o=0,i=0;i<t.length;i++)""!==t[i].url&&n.push(t[i].url);for(i=0;i<n.length;i++){var r=new Image;r.src=n[i],r.onload=function(){o++,$(".laodpecent>.nowpencent").css({"-webkit-transform":"translate3d(0,-"+o/n.length*100+"%,0)","-webkit-transition":"1s ease-in 0s"})}}$(".laodpecent>.nowpencent")[0].addEventListener("webkitTransitionEnd",e)}}]);
creatshowmodule.controller("shareCtrl",["$http","$scope","$rootScope","$stateParams","$ionicLoading","$state","$ionicActionSheet","sendShowImg","SBMJSONP","checklocalimg","loginCheck","drawShowImg","compressShowImg","creatpsurl","saveShow","checkoutbaobei",function(t,a,e,i,r,n,s,o,c,h,l,p,d,g,m,u){function f(t){a.shareData=t,a.shareurl=g(e.orgName,a.shareData.detailId,a.shareData.numIid,a.shareData.plat),u(t.numIid,t.plat)}function w(t){function e(t){"dragstart"===t.type?(s.startpoint[0]=s.point[0],s.startpoint[1]=s.point[1]):s.scale[1]=s.scale[0]}function i(t){t.gesture.srcEvent.preventDefault(),"drag"===t.type?(s.point[0]=parseInt(t.gesture.deltaX)+s.startpoint[0],s.point[1]=parseInt(t.gesture.deltaY)+s.startpoint[1]):s.scale[0]=t.gesture.scale*s.scale[1],r()}function r(){n.find("img").css({"-webkit-transform":"translate3d("+s.point[0]+"px,"+s.point[1]+"px,0px) scale("+s.scale[0]+")"}),$(".backimgbox>img").css({"-webkit-transform":"translate3d("+s.point[0]+"px,"+s.point[1]+"px,0px) scale("+s.scale[0]+")"})}$(".editimg").show(),$(".editcheckimg").attr("src",t),a.shareimgdata||(a.shareimgdata={},ionic.onGesture("dragstart",e,$(".editimg")[0]),ionic.onGesture("drag",i,$(".editimg")[0]),ionic.onGesture("transformstart",e,$(".editimg")[0]),ionic.onGesture("transform",i,$(".editimg")[0]));var n=$("#shareimgedit"),s=a.shareimgdata;s.startpoint=[0,0],s.point=[0,0],s.scale=[1,1],r(),s.img=n.find("img")[0],s.imgbox=n}l(),a.shareurl="",a.shareInfo={orgName:e.orgName,detailId:i.showId},a.shareInfo.method="softbanana.app.detail.search";var I=c("searchDetail",a.shareInfo);t.jsonp(I.url).success(function(t){e.editShowData={mainData:t},f(t)}).error(function(t,a){}),a.istaobao=e.istaobao,void 0!==e.picurl&&(w(e.picurl),e.picurl=void 0),a.checkshareimg=function(t){s.show({buttons:[{text:"本机图片"},{text:"店铺图片空间"}],titleText:"选择图片源",cancelText:"取消",cancel:function(){},buttonClicked:function(t){return 0===t?h(function(t){w(t.src)}):n.go("remoteimg"),!0}})},a.sharethis=function(t){if(e.zmyOnsale){var i="&from=";i+="weixin"===t?"groupmessage":t;var r={titlle:a.shareData.detailTitle,image:a.shareData.detailImage,describe:a.shareData.detailDesc,url:a.shareurl+i,way:t};JavaScriptInterface.shareWithjson(JSON.stringify(r))}},a.getthispic=function(){var t=p(a.shareimgdata);$(".editimg").hide(),r.show({template:"正在保存,请稍等..."}),o(d(t,80),function(t){a.shareData.detailImage=t,m(a.shareData,function(t){r.hide()},function(){})})},a.saveshowadata=function(){m(a.shareData,function(t){r.hide()},function(){})},a.dropthispic=function(){$(".editimg").hide()},a.share=function(){Tida.share({title:"分享的标题",content:"分享内容",url:"http://192.168.1.213/sbmproject/ps.html?orgname=work&detailid=987984&productid=44296753642&plat=TAOBAO",image:"http://192.168.1.213/sbmproject/img/shareimg.jpg",wxIsAvailable:1,wxImage:1,targets:[0,1,2,3,4,5,6,7],weixinAppId:"wxf475808481f0620a",weixinMsgType:"webpage"},function(t){})}}]).controller("sharehelpCtrl",["$scope",function(t){}]);
creatshowmodule.controller("editerCtrl",["$scope","$rootScope","$http","$ionicLoading","$stateParams","$location","$cacheFactory","changepagesize",function(a,t,e,o,n,i,s,d){d(),t.editShowData.ddd="cccc",t.editShowData.showId=n.showId,t.editShowData.currentpage=parseInt(n.pageId),a.$emit("showdatachanged");i.absUrl();if(s.get("cacheback")){var r=s.get("cacheback"),c=r.get("url"),h=r.get("count");"1"!=c&&(h+=1,r.put("count",h))}}]).controller("editpagesCtrl",["$scope","$rootScope","$state","$http","$ionicLoading","$ionicScrollDelegate","$stateParams","SBMJSONP","saveShow","creatpsurl","$ionicPopup","changepagesize",function(a,t,e,o,n,i,s,d,r,c,h,p){a.saveShow=function(){n.show({template:"正在保存,请稍等..."}),r(t.editShowData.mainData,function(a){n.hide(),t.SaveChange=!0,e.go("share",{showId:t.editShowData.showId})},function(a){n.hide(),alert(a)})},t.editShowData||(t.showId="",t.editShowData={showId:"",currentpage:0,mainData:"",dddd:""});var g=t.editShowData;a.goprev=function(){var o=g.currentpage-1;0>o&&(n.show({template:"已是第一张"}),o=0);var i=$(".pagelist").parent().width()-65,s=$(".pagelist").find(".current").offset().left;65>=s?$(".pagelist").parent().css({"-webkit-transform":"translate3d(0px, 0px, 0px) scale(1)",transition:".3s all"}):s>=i&&$(".pagelist").parent().css({"-webkit-transform":"translate3d(-"+i+"px, 0px, 0px) scale(1)",transition:".3s all"}),setTimeout(function(){n.hide()},2e3);var d={showId:g.showId,pageId:o,pageTemp:g.mainData.pages[o].templatePageId};t.xychange===!0?(t.SaveChange=!0,a.$broadcast("saveShowImg"),t.xychange=void 0):e.go("editpages.editer",d)},a.gonext=function(){var o=g.currentpage+1;o>g.mainData.pages.length-1&&(n.show({template:"已是最后一张"}),o=g.mainData.pages.length-1);var i=$(".pagelist").parent().width()-65,s=$(".pagelist").find(".current").offset().left;s>=i?$(".pagelist").parent().css({"-webkit-transform":"translate3d(-"+i+"px, 0px, 0px) scale(1)",transition:".3s all"}):65>=s&&$(".pagelist").parent().css({"-webkit-transform":"translate3d(0px, 0px, 0px) scale(1)",transition:".3s all"}),setTimeout(function(){n.hide()},2e3);var d={showId:g.showId,pageId:o,pageTemp:g.mainData.pages[o].templatePageId};t.xychange===!0?(t.SaveChange=!0,a.$broadcast("saveShowImg"),t.xychange=void 0):e.go("editpages.editer",d)},a.playthisshow=function(){t.$broadcast("saveShowImg"),a.$on("saveShowImgOver",function(){e.go("viewshow",{showId:t.editShowData.showId})})};var l;a.$on("$destroy",function(){"function"==typeof l&&l()}),a.addpage=function(){t.$broadcast("saveShowImg"),"function"==typeof l&&l(),l=a.$on("saveShowImgOver",function(){g.mainData.pages.length>9?h.show({template:"最多十页",buttons:[{text:"我知道了",type:"button-energized"}]}):e.go("addpage",{showId:t.editShowData.showId,pageId:t.editShowData.currentpage})})},a.pagelistwidth={width:0},a.$on("showdatachanged",function(){if(t.editShowData.mainData&&"undefined"!=typeof t.editShowData.mainData.pages,!t.editShowData.mainData||t.editShowData.showId!==t.editShowData.mainData.detailId){var a={orgName:t.orgName,detailId:t.editShowData.showId,method:"softbanana.app.detail.search"},e=d("searchDetail",a);o.jsonp(e.url).success(function(a){return a.isSuccess?(t.editShowData.mainData=a,(void 0===t.SaveChange||t.SaveChange===!0)&&(t.SaveChange=!1),void p()):void alert("获取宝贝秀数据失败")}).error(function(){alert("更新宝贝秀数据失败")})}})}]).controller("pagetemp1Ctrl",["$scope","$state",function(a,t){}]).controller("pagetemp5Ctrl",["$scope","$state",function(a,t){}]);
var loginmodule=angular.module("loginmodule",["ionic","starter.services","starter.directives"]);loginmodule.controller("LoginCtrl",["$scope","$rootScope","$http","$ionicLoading","$ionicPopup","loginSubmit","myCookie","base64","$state","SBMJSONP",function(e,o,r,t,i,a,s,p,n,c){e.logindata={orgName:"",userName:"",password:""};var d={orgName:o.orgName,status:0,pageSize:50,method:"softbanana.app.shop.search"},u=c("searchShop",d);r.jsonp(u.url).success(function(e){}),e.loginSubmit=function(r){return""===e.logindata.orgName?($(".error-tip").eq(0).children(".rect").text("商家名称不允许为空"),void $(".error-tip").eq(0).show()):""===e.logindata.userName?($(".error-tip").eq(1).children(".rect").text("用户名不允许为空"),void $(".error-tip").eq(1).show()):""===e.logindata.password?($(".error-tip").eq(2).children(".rect").text("密码不允许为空"),void $(".error-tip").eq(2).show()):(t.show({template:"正在登陆,请稍后..."}),void a(r,function(e){t.hide(),s.add("orgName",p.encode(r.orgName),720),s.add("userName",p.encode(r.userName),720),o.orgName=r.orgName,o.userName=r.userName,o.orgCode=e.user.orgCode,n.go("home")},function(e){t.hide(),"对应的商家不存在"==e?($(".error-tip").eq(0).children(".rect").text(e),$(".error-tip").eq(0).show()):"用户名不存在"==e?($(".error-tip").eq(1).children(".rect").text(e),$(".error-tip").eq(1).show()):"密码错误"==e?($(".error-tip").eq(2).children(".rect").text(e),$(".error-tip").eq(2).show()):i.show({title:"登录失败",template:e,buttons:[{text:"再试一次",type:"button-energized"}]})}))},e.hidetip=function(){$(".error-tip").hide()}}]).controller("sign_upCtrl",["$rootScope","$scope","$state","$ionicPopup","$http","$ionicLoading","SBMJSONP","myCookie","base64",function($rootScope,$scope,$state,$ionicPopup,$http,$ionicLoading,SBMJSONP,myCookie,base64){function strToJson(str){var json=eval("("+str+")");return json}$scope.yourdata={orgName:"",userName:"",password:"",phone:"",email:"",channel:"app"},$scope.password={password:""},$scope.orgblur=function(e){$scope.orgexist=!1,$scope.orgnameAr={method:"softbanana.app.check.orgname",orgName:$scope.yourdata.orgName};var o=SBMJSONP("checkOrgName",$scope.orgnameAr);$http.jsonp(o.url).success(function(e){(e.isSuccess||"999"!=e.map.errorCode)&&e.isSuccess&&$(".popup-container").length<=0&&($ionicPopup.show({title:"温馨提示",template:"商家名已存在，请重新输入！",buttons:[{text:"我知道了",type:"button-energized"}]}),$scope.yourdata.orgName="")}).error(function(e,o){})},$scope.sign_up=function(){if(""===$scope.yourdata.orgName)return $(".error-tip").eq(0).children(".rect").text("请输入商家名称"),void $(".error-tip").eq(0).show();if(""===$scope.yourdata.userName)return $(".error-tip").eq(1).children(".rect").text("请输入用户名"),void $(".error-tip").eq(1).show();var e=/^(([\u4e00-\u9fa5]|[a-zA-Z0-9])+)$/;if(""===$scope.yourdata.orgName)return $(".error-tip").eq(0).children(".rect").text("请输入商家名称"),void $(".error-tip").eq(0).show();if(!e.test($scope.yourdata.orgName))return $(".error-tip").eq(0).children(".rect").text("不能输入特殊字符"),void $(".error-tip").eq(0).show();var o=/^(([\u4e00-\u9fa5]|[a-zA-Z0-9])+)$/;if(""===$scope.yourdata.userName)return $(".error-tip").eq(1).children(".rect").text("请输入用户名"),void $(".error-tip").eq(1).show();if(!o.test($scope.yourdata.userName))return $(".error-tip").eq(1).children(".rect").text("不能输入特殊字符"),void $(".error-tip").eq(1).show();if(""===$scope.yourdata.password)return $(".error-tip").eq(2).children(".rect").text("请输入密码"),void $(".error-tip").eq(2).show();if($scope.yourdata.password.length<6||$scope.yourdata.password.length>12)return $(".error-tip").eq(2).children(".rect").text("密码请再6~12位之间"),void $(".error-tip").eq(2).show();if($scope.yourdata.password!==$scope.password.password)return $(".error-tip").eq(3).children(".rect").text("两次输入的密码不一致"),void $(".error-tip").eq(3).show();var r=/^1\d{10}$/;if(!r.test($scope.yourdata.phone)&&""!==$scope.yourdata.phone)return void $(".error-tip").eq(4).show();var t=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!t.test($scope.yourdata.email)&&""!==$scope.yourdata.email)return void $(".error-tip").eq(5).show();$scope.yourdata.method="softbanana.app.user.regist";var i=SBMJSONP("registUser",$scope.yourdata);$ionicLoading.show({template:"正在注册信息，请稍等..."}),$http.jsonp(i.url).success(function(e){if($ionicLoading.hide(),e.isSuccess){var o=$ionicPopup.show({title:"注册成功",template:"注册消息已发送到邮箱，请妥善保管！",buttons:[{text:"我知道了",type:"button-energized"}]});o.then(function(e){myCookie.add("orgName",base64.encode($scope.yourdata.orgName),720),myCookie.add("userName",base64.encode($scope.yourdata.userName),720),$rootScope.orgName=$scope.yourdata.orgName,$rootScope.userName=$scope.yourdata.userName,$state.go("taoxiaopu")})}else $ionicPopup.show({title:"注册失败",template:e.map.errorMsg,buttons:[{text:"去改下资料",type:"button-energized"}]})}).error(function(e,o){$ionicLoading.hide()})},$scope.hidetip=function(){$(".error-tip").hide()}}]);
loginmodule.factory("loginSubmit",["$rootScope","$http","$state","$ionicPopup","SBMJSONP","myCookie","base64",function(o,t,e,n,i,r,s){return function(o,e,r){o.method="softbanana.app.user.login";var s=i("userLogin",o);t.jsonp(s.url).success(function(o){o.isSuccess?e(o):r(o.map.errorMsg)}).error(function(o,t){n.show({title:"登录出错",template:"可能您的网络出问题了",buttons:[{text:"好的吧",type:"button-energized"}]})})}}]);
!function(t){t.fn.touchSlider=function(i){function e(){wubuslidersettime=setTimeout(n,h.timeinterval)}function n(){o(),setTimeout(r),wubuslidersettime=setTimeout(n,h.timeinterval)}function o(i,e){function n(){t(l[x.index])[0].removeEventListener("webkitTransitionEnd",n,!1),x.notouch=!1}return x.notouch||!x.leftrighttouch?void(x.leftrighttouch||(x.notouch=!1)):(i="number"==typeof i?i:0,e="number"==typeof e?e:0,0!==i&&(x.notouch=!0,t(l[x.index])[0].addEventListener("webkitTransitionEnd",n,!1)),t(l[x.index]).css({transform:"translate3d("+(0+e)+"px,0px,0px)",transition:i+"s ease-out","-webkit-transform":"translate3d("+(0+e)+"px,0px,0px)","-webkit-transition":i+"s ease-out"}),(0===i||x.direction>=0)&&t(l[x.prevpic]).css({transform:"translate3d("+(-m+e)+"px,0px,0px)",transition:i+"s ease-out","-webkit-transform":"translate3d("+(-m+e)+"px,0px,0px)","-webkit-transition":i+"s ease-out"}),(0===i||x.direction<=0)&&t(l[x.nextpic]).css({transform:"translate3d("+(m+e)+"px,0px,0px)",transition:i+"s ease-out","-webkit-transform":"translate3d("+(m+e)+"px,0px,0px)","-webkit-transition":i+"s ease-out"}),void(0!==i&&h.sliderpoint&&0!==x.direction&&(t(".currentsliderpoint").css({"background-color":h.sliderpointbgcolor}).removeClass("currentsliderpoint"),"undefined"==typeof therejusttwopic?t(k[x.index]).addClass("currentsliderpoint").css({"background-color":h.sliderpointcolor}):t(k[x.index>1?x.index-2:x.index]).addClass("currentsliderpoint").css({"background-color":h.sliderpointcolor}))))}function r(){x.init(x.index+1),o(h.animatetime/1e3)}function s(){x.init(x.index-1),o(h.animatetime/1e3)}function a(){x.init(),o(h.animatetime/2e3)}function d(t){h.automatic&&clearTimeout(wubuslidersettime);var i=t.targetTouches[0];x.start[0]=i.clientX,x.start[1]=i.clientY,x.starttime=t.timeStamp,o()}function c(t){function i(){x.notouch=!1}if(!x.notouch){var e=t.targetTouches[0];x.now[0]=e.clientX,x.now[1]=e.clientY,x.nowtime=t.timeStamp;var n=x.now[0]-x.start[0],r=x.now[1]-x.start[1],s=x.nowtime-x.starttime;if(800>s&&!x.leftrighttouch)if(Math.abs(n)>6&&Math.abs(r)<20)t.preventDefault(),x.leftrighttouch=!0;else if(Math.abs(n)<20&&Math.abs(r)>20){if(x.notouch=!0,navigator.userAgent.match(/Android/i)){try{clearTimeout(clearnotoucht)}catch(a){}clearnotoucht=setTimeout(i,500)}return}var d=n;o(0,d)}}function u(i){var n=i.changedTouches[0];x.end[0]=n.clientX,x.end[1]=n.clientY,x.endtime=i.timeStamp;var d=x.end[0]-x.start[0],c=x.end[1]-x.start[1],u=x.endtime-x.starttime;return 250>u&&Math.abs(d)<8&&Math.abs(c)<8?void("string"==typeof t(l[x.index]).attr("href")&&(window.location.href=t(l[x.index]).attr("href"))):(x.init(),d>30&&x.leftrighttouch?s():-30>d&&x.leftrighttouch?r():Math.abs(d)<=10?(o(),x.notouch=!0):a(),x.leftrighttouch=!1,void(h.automatic&&e()))}var l=t(this).children();if(1!=l.size()){2==l.size()&&(t(this).append(l.clone()),l=t(this).children(),therejusttwopic=!0);var h={circulate:!1,automatic:!1,sliderpoint:!0,sliderpointwidth:8,sliderpointcolor:"#aaa",sliderpointbgcolor:"#eee",timeinterval:3e3,animatetime:300};if("undefined"!=typeof i)for(var p in i)typeof h[p]==typeof i[p]&&(h[p]=i[p]);var f=l.size(),m=t(this).width(),x=(t(this).height(),{index:0,notouch:!1,leftrighttouch:!1,starttime:0,nowtime:0,endtime:0,start:[0,0],now:[0,0],end:[0,0],direction:0,init:function(t){"number"==typeof t?0>t?(this.direction=-1,this.index=f-1):t>=f?(this.direction=1,this.index=0):(this.direction=t>this.index?1:-1,this.index=t):this.direction=0;var i=x.index-1;this.prevpic=i>=0?i:f-1;var e=x.index+1;this.nextpic=f>e?e:0}});if(x.init(),t(this).css({position:"relative"}).find("a").click(function(t){t.preventDefault()}),l.each(function(i){var e=0===i?0:1;t(this).css({width:m,transform:"translate3d("+m*e+"px,0px,0px)",transition:"0s ease-out","-webkit-transform":"translate3d("+m*e+"px,0px,0px)","-webkit-transition":"0s ease-out",position:"absolute"})}),h.sliderpoint){t(this).append(t("<ul class='pointlist'><li class='currentsliderpoint'></li></ul>"));var b=Math.ceil(h.sliderpointwidth/5),w=2*b+h.sliderpointwidth,v=w*f;if("undefined"==typeof therejusttwopic)for(var g=1;f>g;g++)t(".pointlist").append(t("<li></li>"));else v=2*w,t(".pointlist").append(t("<li></li>"));var k=t(this).find(".pointlist").find("li");t(this).find(".pointlist").css({width:v,height:w,position:"absolute",padding:0,bottom:"10px",left:"50%","margin-left":-v/2}),k.css({"list-style":"none",width:h.sliderpointwidth,height:h.sliderpointwidth,"border-radius":h.sliderpointwidth,margin:b,"float":"left","background-color":h.sliderpointbgcolor,transition:h.animatetime/1e3+"s ease-out","-webkit-transition":h.animatetime/1e3+"s ease-out"}),t(".currentsliderpoint").css({"background-color":h.sliderpointcolor})}return t(this).bind("touchstart",function(t){d(t)}),t(this).bind("touchmove",function(t){c(t)}),t(this).bind("touchend",function(t){u(t)}),h.automatic&&e(),t(this)}}}("undefined"!=typeof jQuery?jQuery:window.Zepto);
starterctrl.controller("ordersCtrl",["$scope","$ionicPopover","$http","$ionicLoading","SBMJSONP","$rootScope","$state","dateFormat","orderComm","getDataComm",function(t,e,r,a,o,s,i,d,n,l){var u={},p={};u={lastId:"",pageSize:10,direction:"",orgName:s.orgName,orderStatusList:n.orderStatusList,orderList:[],shopList:[],currOrderStatus:{name:"全部",status:""},currShop:null,isHaveMoreData:!1},p.init=function(){u.orgName&&"undefined"!=typeof u.orgName?l.loadShopList(function(t){if(t&&t.length>0){for(var e in t){var r=t[e].plat;t[e].img=l.platObj[r].imgSrc}u.shopList=t,u.currShop=u.shopList[0],p.loadData()}},function(){}):i.go("login")},p.loadDataComplete=function(){a.hide(),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),u.isPostBack=!0},p.loadData=function(t){"up"!=u.direction&&a.show({template:"正在加载..."});var e={method:"softbanana.app.trade.search",orgName:u.orgName,shopName:u.currShop.shopName,status:u.currOrderStatus.status,action:u.direction,pageNo:u.lastId,pageSize:u.pageSize,plat:u.currShop.plat},s=o("searchTrade",e);r.jsonp(s.url).success(function(e){for(var r in e.trades)e.trades[r].orderDate=e.trades[r].orderDate.substr(0,10);if(p.loadDataComplete(),t&&(u.orderList=[]),e.isSuccess&&parseInt(e.totalCount)>0&&e.trades&&e.trades.length>0)if(e.trades.sort(function(t,e){return parseInt(t.id)>parseInt(e.id)?-1:1}),"up"===u.direction)for(u.isHaveMoreData=!0,r=0;r<e.trades.length;r++)e.trades[r].statusName=n.getStatusName(e.trades[r].status),u.orderList.push(e.trades[r]);else for(""===u.direction&&(u.isHaveMoreData=!0),r=e.trades.length-1;r>=0;r--)e.trades[r].statusName=n.getStatusName(e.trades[r].status),u.orderList.unshift(e.trades[r]);else"up"===u.direction&&(u.isHaveMoreData=!1)}).error(function(t,e){p.loadDataComplete()})},p.showOrderStatusList=function(){for(var t=[],e=0;e<u.orderStatusList.length;e++)u.currOrderStatus.name!=u.orderStatusList[e].name&&t.push(u.orderStatusList[e]);return t},p.refreshServer=function(){a.show({template:"正在同步..."});var t=new Date,e={method:"softbanana.app.trade.list",orgName:u.orgName,shopName:u.currShop.shopName,plat:u.currShop.plat,endDate:d(t,"yyyy-MM-dd hh:mm:ss")};t.setMonth(t.getMonth()-1),e.startDate=d(t,"yyyy-MM-dd hh:mm:ss");var s=o("listTrade",e);r.jsonp(s.url).success(function(t){setTimeout(function(){p.loadDataComplete()},3e3)}).error(function(t,e){p.loadDataComplete()})},p.refreshOrderList=function(){u.direction="next",u.orderList.length>0&&(u.lastId=u.orderList[0].id),p.loadData()},p.loadMoreData=function(){u.direction="up",u.orderList.length>0&&(u.lastId=u.orderList[u.orderList.length-1].id),p.loadData()},p.loadDataByStatusFilter=function(e){u.currOrderStatus=e,t.popover.hide(),u.lastId=1,u.direction="",p.loadData(!0)},p.loadDataByShop=function(t,e){u.currShop=t;for(var r in u.shopList)u.shopList[r].checked=u.shopList[r].id===t.id;u.lastId=1,u.direction="",p.loadData(!0)},p.showOrderDetail=function(t){var e={orgName:u.orgName,shopName:t.shopName,tid:t.orderNumber,plat:t.plat};localStorage.setItem("currSelectOrder",JSON.stringify(e)),i.go("orderdetail")},e.fromTemplateUrl("pageTplorderStatusfilterPopover",{scope:t}).then(function(e){t.popover=e}),t.pageData=u,t.pageFunc=p,p.init()}]);
starterctrl.controller("orderdetailCtrl",["$scope","$http","$state","SBMJSONP","$ionicLoading","orderComm",function(e,r,t,a,o,l){var d={},i={};i={currSelectOrder:JSON.parse(localStorage.getItem("currSelectOrder")),orderDetail:{},isPageShow:!1},d.init=function(){i.currSelectOrder?d.loadOrderDetail():t.go("orders")},d.loadOrderDetail=function(){o.show({template:"正在加载..."});var e={method:"softbanana.app.trade.detail.search",orgName:i.currSelectOrder.orgName,shopName:i.currSelectOrder.shopName,tid:i.currSelectOrder.tid,plat:i.currSelectOrder.plat},t=a("searchTradeDetail",e);r.jsonp(t.url).success(function(e){o.hide(),e.isSuccess&&(i.orderDetail=e.trade,i.orderDetail.statusName=l.getStatusName(i.orderDetail.status),i.orderDetail.buyerMessage||(i.orderDetail.buyerMessage="无"),i.orderDetail.totalAmount=parseFloat(i.orderDetail.totalAmount),i.orderDetail.postFee=parseFloat(i.orderDetail.postFee),"ONLINE_PAYMENT"==i.orderDetail.paymentType&&(i.orderDetail.paymentType="在线支付"),"COD"==i.orderDetail.paymentType&&(i.orderDetail.paymentType="货到付款"),i.orderDetail.orderDate=new Date(i.orderDetail.orderDate).getTime(),i.isPageShow=!0)}).error(function(e,r){o.hide()})},e.pageData=i,d.init()}]);
var productsmodule=angular.module("productsmodule",["ionic","starter.services","starter.directives"]);productsmodule.controller("productsCtrl",["$scope","$ionicLoading","$rootScope","$state","$ionicScrollDelegate","productComm","getDataComm","loginCheck","TBAPI","showedition",function(t,o,e,a,r,i,s,c,u,p){u.hideTitle();var l={},n={};t.thereisnoproduct="",l={lastId:"",pageSize:10,direction:"",orgName:e.orgName,productList:[],shopList:[],currStatus:"onsale",isOnsaleStatus:!0,currShop:null,isHaveMoreData:!1,isPostBack:!1,pageViewState:JSON.parse(sessionStorage.getItem("productListPageViewState"))},t.showediticon=function(t){p(t)},n.init=function(){return l.pageViewState?(l.currShop=l.pageViewState.currShop,l.currStatus=l.pageViewState.currStatus,l.isOnsaleStatus="onsale"==l.currStatus):l.pageViewState={currShop:{},currStatus:"onsale"},e.istaobao?(l.currShop={plat:e.plat,shopName:e.shopName},void n.loadData()):void s.loadShopList(function(t){if(t&&t.length>0){for(var o in t){var e=t[o].plat;t[o].img=s.platObj[e].imgSrc}l.shopList=t,null===l.currShop?l.currShop=l.shopList[0]:n.setSelectShop(l.currShop),n.loadData()}},function(t){})},n.setCurrPageViewState=function(t,o){l.pageViewState.currShop=t,l.pageViewState.currStatus=o,l.currStatus=o,l.isOnsaleStatus="onsale"==o,sessionStorage.setItem("productListPageViewState",JSON.stringify(l.pageViewState))},n.loadDataComplete=function(){o.hide(),t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),l.isPostBack=!0,setTimeout(function(){e.zmyscrollTop&&e.zmyscrollTop>0?(r.$getByHandle("mainScroll").scrollTo(0,e.zmyscrollTop),e.zmyscrollTop=0):e.zmyscrollTop=0})},n.loadDataByShop=function(t){n.setSelectShop(t),l.lastId="",l.direction="",n.loadData(!0)},n.setSelectShop=function(t){for(var o in l.shopList)l.shopList[o].id===t.id?(l.shopList[o].checked=!0,l.currShop=l.shopList[o]):l.shopList[o].checked=!1;n.setCurrPageViewState(l.currShop,"onsale")},n.refreshServer=function(){return l.currShop?(o.show({template:"正在同步..."}),i.refreshServer({shopName:l.currShop.shopName,plat:l.currShop.plat},function(t){o.hide()},function(t){n.loadDataComplete()}),void setTimeout(function(){n.loadDataComplete()},3e3)):void o.show({template:"没有店铺，无法同步",duration:2e3})},n.refreshproductList=function(){l.direction="next",l.productList.length>0&&(l.lastId=l.productList[0].id),n.loadData()},n.loadMoreData=function(){l.direction="up",l.productList.length>0&&(l.lastId=l.productList[l.productList.length-1].id),n.loadData()},n.loadDataByStatus=function(t){l.lastId="",l.direction="",l.currStatus=t,n.setCurrPageViewState(null===l.pageViewState.currShop?l.shopList[0]:l.pageViewState.currShop,l.currStatus),n.loadData(!0)},n.loadData=function(e){"up"!=l.direction&&o.show({template:"正在加载...",duration:2e3});var a={shopName:l.currShop.shopName,status:l.currStatus,action:l.direction,pageNo:l.lastId,pageSize:l.pageSize,plat:l.currShop.plat};i.loadProductData(a,function(o){return n.loadDataComplete(),0===o.length&&"up"===l.direction?(""===t.thereisnoproduct&&(t.thereisnoproduct=!0,$(".noproduct-bg").show()),void(l.isHaveMoreData=!1)):(t.thereisnoproduct=!1,e&&(l.productList=[]),l.productList="up"===l.direction?l.productList.concat(o):o.concat(l.productList),l.isPostBack&&("up"===l.direction||""===l.direction)&&o.length>0&&(l.isHaveMoreData=!0),void(l.isPostBack=!0))},function(t,o,e){n.loadDataComplete()})},n.showDetail=function(t){var o={orgName:l.orgName,numIid:t.numIid,plat:t.plat};e.zmyscrollTop=r.getScrollPosition().top,localStorage.setItem("currSelectProduct",JSON.stringify(o)),a.go("productDetail")},t.pageData=l,t.pageFunc=n,c(),n.init()}]);
productsmodule.controller("productDetailCtrl",["$rootScope","$scope","$http","$state","$stateParams","$ionicLoading","productComm","$ionicSlideBoxDelegate","creatShow","SBMJSONP","showedition",function(e,t,a,r,o,i,d,l,c,n,s){var u={},p={};p={currSelectOrder:JSON.parse(localStorage.getItem("currSelectProduct")),orderDetail:{},isPageShow:!1},u.init=function(){p.currSelectOrder?u.loadProductDetail():r.go("orders")},t.refresh=function(){u.loadProductDetail()},u.loadProductDetail=function(){i.show({template:"正在加载..."}),d.loadProductDetail({orgName:p.currSelectOrder.orgName,numIid:p.currSelectOrder.numIid,plat:p.currSelectOrder.plat},function(e){i.hide(),p.orderDetail=e,p.orderDetail.picArr=p.orderDetail.picUrl.split(","),p.isPageShow=!0,setTimeout(function(){$("#sliders").touchSlider({animatetime:300,automatic:!0,timeinterval:4e3,sliderpoint:!0,sliderpointwidth:8,sliderpointcolor:"#fa9d00"})},200),t.$broadcast("scroll.refreshComplete")},function(e){i.hide()})},u.slideHasChanged=function(e){},t.dele=function(r){t.deldata={orgName:e.orgName,detailId:r},t.deldata.method="softbanana.app.detail.delete";var o=n("deleteDetail",t.deldata);a.jsonp(o.url).success(function(e){if(e.isSuccess)for(var a in p.orderDetail.appDetailCounts)p.orderDetail.appDetailCounts[a].detailId==t.deldata.detailId&&p.orderDetail.appDetailCounts.splice(a,1)}).error(function(e,t){})},t.edit=function(o){t.detaildata={orgName:e.orgName,detailId:o},t.detaildata.method="softbanana.app.detail.search";var i=n("searchDetail",t.detaildata);a.jsonp(i.url).success(function(e){e.isSuccess&&r.go("editpages.editer",{showId:o,pageId:0,pageTemp:e.pages[0].templatePageId})}).error(function(e,t){})},t.pageData=p,u.init(),t.showediticon=function(e){s(e)}}]);
var settingmodule=angular.module("settingmodule",["ionic","starter.services","starter.directives"]);settingmodule.controller("settingCtrl",["$scope","$ionicPopup","$state","myCookie","loginCheck","TBAPI",function(e,o,t,s,r,a){a.hideTitle(),e.logout=function(){o.show({template:"你确定要退出？",title:"提示",buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-energized",onTap:function(e){s["delete"]("orgName"),t.go("login")}}]})}}]).controller("setPassword",["$rootScope","$scope","$state","$http","$ionicLoading","$ionicPopup","SBMJSONP",function(e,o,t,s,r,a,n){o.setdata={orgName:e.orgName,userName:e.userName,oldPassword:"",newPassword:""},o.setPw=function(){if(o.setdata.newPassword!=o.setdata.newPassword1&&""!==o.setdata.newPassword)return void $(".error-tip").eq(2).show();o.setdata.method="softbanana.app.password.update";var e=n("updatePassword",o.setdata);r.show({template:"正在修改请稍等..."}),s.jsonp(e.url).success(function(e){if(r.hide(),e.isSuccess){var o=a.show({title:"提示信息",template:"密码修改成功,请重新登录",buttons:[{text:"好的",type:"button-energized"}]});o.then(function(e){t.go("login")})}else"旧密码不允许为空"===e.map.errorMsg?($(".error-tip").eq(0).children(".rect").text(e.map.errorMsg),$(".error-tip").eq(0).show()):"密码错误"===e.map.errorMsg?($(".error-tip").eq(0).children(".rect").text(e.map.errorMsg),$(".error-tip").eq(0).show()):"密码修改失败"===e.map.errorMsg?($(".error-tip").eq(2).children(".rect").text(e.map.errorMsg),$(".error-tip").eq(2).show()):"新密码不允许为空"===e.map.errorMsg&&($(".error-tip").eq(1).children(".rect").text(e.map.errorMsg),$(".error-tip").eq(1).show())}).error(function(e,o){})},o.hidetip=function(){$(".error-tip").hide()}}]).controller("shopManage",["$rootScope","$scope","$state","$http","SBMJSONP","getDataComm","$ionicPopup","showedition","shouquan",function(e,o,t,s,r,a,n,i,p){o.orgdatas={orgName:e.orgName,pageNo:1,pageSize:50},o.orgdatas.method="softbanana.app.shop.search";var c=r("searchShop",o.orgdatas);s.jsonp(c.url).success(function(e){o.shopList=e;for(var t in o.shopList.shops){var s=o.shopList.shops[t].plat;o.shopList.shops[t].imgsrc=a.platObj[s].imgSrc,o.shopList.shops[t].isInvalid="1"===o.shopList.shops[t].isInvalid}}).error(function(e,o){}),o.showediticon=function(e){i(e)},o.del=function(e,t){n.show({template:"删除店铺将无法获取宝贝、订单也无法分享店铺中的宝贝详情，您确定要删除吗？",buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-energized",onTap:function(s){o.delshop(e,t)}}]})},o.goon=function(e,o){t.go("shouquanhelp")},o.delshop=function(t,a){o.delshopinfo={orgName:e.orgName,plat:t,shopName:a},o.delshopinfo.method="softbanana.app.shop.delete";var n=r("deleteShop",o.delshopinfo);s.jsonp(n.url).success(function(e){if(e.isSuccess)for(var t in o.shopList.shops)o.shopList.shops[t].shopName==o.delshopinfo.shopName&&o.shopList.shops.splice(t,1)}).error(function(e,o){})}}]).controller("feedBack",["$rootScope","$scope","$state","$http","SBMJSONP","getDataComm","$ionicPopup",function(e,o,t,s,r,a,n){o.feeddata={orgName:e.orgName,terminalInfo:navigator.userAgent,text:""},o.feedback=function(){var e=$(".feedbacktext").val();if(e.length>0){o.feeddata.method="softbanana.app.feedback.save";var t=r("saveFeedBack",o.feeddata);s.jsonp(t.url).success(function(e){n.show({template:"已收录，感谢您的反馈。",buttons:[{text:"确定",type:"button-energized"}]})}).error(function(e,o){})}else n.show({template:"请输入反馈信息",buttons:[{text:"确定",type:"button-energized"}]})}}]).controller("shopsCtrl",["$rootScope","$scope","$state","shouquan",function(e,o,t,s){o.youzan=s.KDT,o.weidian=s.WD,o.taobao=s.TAOBAO,o.jingdong=s.JINGD,o.paipai=s.PAIPAI,o.yihaodian=s.YHD,o.dangdang=s.DANGDANG}]).controller("viewshopCtrl",["$scope","$state","$stateParams",function(e,o,t){$(".viewtemplate").append('<iframe style="overflow-x:auto;overflow-y:auto;" class="viewbox" src='+t.url+' frameborder="0"></iframe>'),e.viewbtnneam="首页",e.viewneam="店铺授权",e.viewbtn=function(){o.go("home")}}]).controller("showCtrl",["$scope","$state","$ionicPopup","myCookie","loginCheck",function(e,o,t,s,r){alert(1234)}]).controller("taoxiaopuCtrl",["$scope","$rootScope","$state",function(e,o,t){e.gotaoxiaopu=function(){var e="https://oauth.taobao.com/authorize?response_type=code&client_id=23127514&redirect_uri=http://baobeixiu.play.admin.jaeapp.com/bbxShopNameIsExists&view=wap&state=app"+o.orgName;JavaScriptInterface.openWebWith(e)}}]);
var showsmodule=angular.module("showsmodule",["ionic","starter.services","starter.directives"]);showsmodule.controller("showsCtrl",["$rootScope","$scope","$http","$state","$stateParams","$ionicLoading","$ionicListDelegate","productComm","$ionicSlideBoxDelegate","creatShow","SBMJSONP","TBAPI","showedition","$ionicPopup",function(t,a,e,o,s,i,n,l,r,d,c,h,u,p){function w(t){a.showsList={orgName:t.orgName,pageNo:t.lastId,pageSize:t.pageSize,action:t.direction,isHaveMoreData:t.isHaveMoreData,isPostBack:t.isPostBack,method:"softbanana.app.detail.list"};var o=c("listDetail",a.showsList);e.jsonp(o.url).success(function(t){a.thereisnoshow=(""===a.thereisnoshow||a.thereisnoshow===!0)&&t.details.length<=0?!0:!1,f();for(var e in t.details)""===t.details[e].llCount&&(t.details[e].llCount=0),""===t.details[e].ddCount&&(t.details[e].ddCount=0),""===t.details[e].zfCount&&(t.details[e].zfCount=0),t.details[e].postDate=t.details[e].postDate.substr(0,10);return a.showsListData=a.showsListData.concat(t.details),g.isHaveMoreData=!0,0===t.details.length&&"up"===g.direction?void(g.isHaveMoreData=!1):(g.isPostBack&&("up"===g.direction||""===g.direction)&&t.details.length>0&&(g.isHaveMoreData=!0),g.isPostBack=!0,void a.$broadcast("scroll.infiniteScrollComplete"))}).error(function(t,a){f()})}function f(){i.hide(),a.$broadcast("scroll.refreshComplete"),a.$broadcast("scroll.infiniteScrollComplete"),g.isPostBack=!0}h.hideTitle(),a.showsListData=[],a.thereisnoshow="";var g={};g={orgName:t.orgName,pageSize:10,lastId:0,direction:"",isPostBack:!1,isHaveMoreData:!1},w(g),a.loadMoreData=function(){g.direction="up",a.showsListData.length>0&&(g.lastId=a.showsListData[a.showsListData.length-1].detailId),w(g)},a.refresh=function(){g.direction="next",a.showsListData.length>0&&(g.lastId=a.showsListData[0].detailId),w(g)},a.dele=function(t){p.show({template:"删除后已经分享过的详情将作废，无法浏览，您确定要删除吗？",buttons:[{text:"取消"},{text:"<b>确定</b>",type:"button-energized",onTap:function(e){a.delshow(t)}}]})},a.delshow=function(o){a.deldata={orgName:t.orgName,detailId:o},a.deldata.method="softbanana.app.detail.delete";var s=c("deleteDetail",a.deldata);e.jsonp(s.url).success(function(t){if(t.isSuccess)for(var e in a.showsListData)a.showsListData[e].detailId==a.deldata.detailId&&a.showsListData.splice(e,1)}).error(function(t,a){})},a.edit=function(s){a.detaildata={orgName:t.orgName,detailId:s},a.detaildata.method="softbanana.app.detail.search";var i=c("searchDetail",a.detaildata);e.jsonp(i.url).success(function(a){a.isSuccess&&(t.editz=!0,o.go("editpages.editer",{showId:s,pageId:0,pageTemp:a.pages[0].templatePageId}))}).error(function(t,a){})},a.showediticon=function(t){u(t)},a.pageData=g}]).controller("liuliangCtrl",["$rootScope","$scope","$http","$state","$stateParams","$ionicLoading","productComm","$ionicSlideBoxDelegate","creatShow","SBMJSONP",function(t,a,e,o,s,i,n,l,r,d){a.showsInfo={orgName:t.orgName,detailId:s.showId},a.showsInfo.method="softbanana.app.report.search";var c=d("searchReport",a.showsInfo);e.jsonp(c.url).success(function(t){function e(){a.tabsBtn.lldetail=!0;var t=["wxFriend","wxFriends","weibo","qq","qzone"],e=[],o=0;for(var s in t){var i=t[s];""===a.showsInfoData.lldetail[i]&&(a.showsInfoData.lldetail[i]=0),a.tabsBtn[i]=a.showsInfoData.lldetail[i],e.push(a.tabsBtn[i])}o=Math.max.apply(null,e);for(var n in e){var l=0==o?0:e[n]/o*160;$(".zhu").eq(n).css("height",l+36),$(".tiao").eq(n).css("height",l)}}function o(){a.tabsBtn={lldetail:!1,dddetail:!1,zfdetail:!1,wxFriend:0,wxFriends:0,weibo:0,qq:0,qzone:0}}a.showsInfoData=t,a.tabsBtn={lldetail:!1,dddetail:!1,zfdetail:!1,wxFriend:0,wxFriends:0,weibo:0,qq:0,qzone:0},e(),a.tabsClick=function(t){o(),a.tabsBtn[t]=!0;var e=["wxFriend","wxFriends","weibo","qq","qzone"],s=[],i=0;for(var n in e){var l=e[n];""===a.showsInfoData[t][l]&&(a.showsInfoData[t][l]=0),a.tabsBtn[l]=a.showsInfoData[t][l],s.push(a.tabsBtn[l])}i=Math.max.apply(null,s);for(var r in s){var d=0==i?0:s[r]/i*160;$(".zhu").eq(r).css("height",d+36),$(".tiao").eq(r).css("height",d)}}}).error(function(t,a){})}]);